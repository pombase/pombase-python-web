<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protein features for {{gene_uniquename}} </title>
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">

    <script src="https://cdn.jsdelivr.net/npm/@rcsb/rcsb-saguaro/build/rcsb-saguaro.js" type="text/javascript"></script>
  </head>
  <body>



    <div id="pfv" style="margin-top:50px" ></div>



    <script language="javascript" type="text/javascript">

window.onload = (event) => {

fetch("https://desktop.kmr.nz/api/v1/dataset/latest/protein_features/{{gene_uniquename}}")
  .then((response) => {
    return response.json();
  })
  .then((data) => {
    console.log(data);

    let rowConfigData = [
      {
        trackId: "sequenceTrack",
        trackHeight: 20,
        trackColor: "#F9F9F9",
        displayType: "sequence",
        nonEmptyDisplay: true,
        rowTitle: "Sequence",
        trackData: [
          {
            begin: 1,
            value: data.sequence
          }
        ]
      }
    ];

    const colours = {
      'TM domains': '#44f',
      'Disordered regions': '#575',
      'Low complexity regions': '#545',
      'Coiled coils': '#9922aa',
      'Variants': '#f00',
    }

    data.tracks.map(track => {
      if (track.features.length > 0) {
        let conf = {
          trackId: track.name,
          trackHeight: 20,
          trackColor: "#fcfcfc",
          displayType: track.display_type,
          displayColor: colours[track.name] || '#ba6',
          rowTitle: track.name,
          trackData: track.features.map(feature => {
            return {
              id: feature.id,
              begin: feature.positions[0][0],
              end: feature.positions[0][1],
            };
          }),
        };

        rowConfigData.push(conf);
      }
    });

    const boardConfigData = {
      length: data.sequence.length,
      trackWidth: 940,
      includeAxis: true
    };

    const elementId = "pfv";
    const pfv = new RcsbFv.Create({
      boardConfigData,
      rowConfigData,
      elementId
    });

/*
    const elementId = "pfv";
    const pfv = new RcsbFv.Create({
      boardConfig,
      rowConfig,
      elementId
    });
*/
  });
};

    </script>
  </body>
</html>
